<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Skila.ai | Riemann Sum Integrator</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'JetBrains Mono', monospace;
            color: white;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .panel {
            pointer-events: auto;
            background: rgba(10, 10, 15, 0.9);
            border: 1px solid #333;
            padding: 20px;
            margin: 20px;
            border-radius: 8px;
        }

        /* HEADER */
        .hdr {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #ef4444;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            color: #ef4444;
        }

        /* CONTROLS */
        .control-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }

        .slider-group {
            flex: 1;
        }

        label {
            display: block;
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }

        input[type=range] {
            width: 100%;
            accent-color: #ef4444;
        }

        .val-box {
            font-size: 20px;
            font-weight: bold;
            color: #fff;
            width: 60px;
            text-align: right;
        }

        /* EQUATION DISPLAY */
        #eqn-disp {
            font-size: 30px;
            margin: 20px 0;
            color: #fda4af;
            text-align: center;
        }

        /* DATA TABLE */
        .data-table {
            width: 100%;
            font-size: 14px;
            color: #ccc;
        }

        .data-table td {
            padding: 5px;
        }

        .hl-val {
            color: #ef4444;
            font-weight: bold;
        }

        /* 3D TOGGLE */
        .btn-toggle {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-toggle.active {
            background: #ef4444;
            border-color: #ef4444;
        }
    </style>
</head>

<body>
    <canvas id="canvas" style="position:absolute; top:0; left:0; width:100%; height:100%;"></canvas>

    <div id="ui-layer">
        <div class="panel" style="width: 400px;">
            <div class="hdr">
                <div class="title">∫ INTEGRATOR</div>
                <div style="font-size:12px; color:#666;">v1.0</div>
            </div>

            <div id="eqn-disp">∫ f(x) dx</div>

            <table class="data-table">
                <tr>
                    <td>Lower Limit (a)</td>
                    <td id="val-a" class="hl-val">0.0</td>
                </tr>
                <tr>
                    <td>Upper Limit (b)</td>
                    <td id="val-b" class="hl-val">5.0</td>
                </tr>
                <tr>
                    <td>Partitions (n)</td>
                    <td id="val-n" class="hl-val">10</td>
                </tr>
                <tr>
                    <td>dx (Width)</td>
                    <td id="val-dx" class="hl-val">0.50</td>
                </tr>
                <tr>
                    <td style="border-top:1px solid #333; padding-top:10px;">APPROX AREA</td>
                    <td id="res-approx" class="hl-val"
                        style="border-top:1px solid #333; padding-top:10px; font-size:24px;">0.00</td>
                </tr>
                <tr>
                    <td>EXACT AREA</td>
                    <td id="res-exact" style="color:#22c55e;">0.00</td>
                </tr>
                <tr>
                    <td>ERROR %</td>
                    <td id="res-err" style="color:#facc15;">0.00%</td>
                </tr>
            </table>

            <div class="control-row">
                <div class="slider-group">
                    <label>NUMBER OF RECTANGLES (n)</label>
                    <input type="range" id="sl-n" min="1" max="200" value="10">
                </div>
            </div>

            <div class="control-row">
                <div class="slider-group">
                    <label>FUNCTION SHAPE</label>
                    <select id="sel-func"
                        style="background:#222; color:white; padding:5px; border:1px solid #444; width:100%;">
                        <option value="poly">Polynom: -0.1(x-4)² + 5</option>
                        <option value="sin">Sine: 2sin(x/2) + 3</option>
                        <option value="exp">Exp: e^(x/3)</option>
                    </select>
                </div>
            </div>

            <div class="control-row">
                <button class="btn-toggle" id="btn-3d" onclick="toggle3D()">3D REVOLUTION</button>
            </div>
        </div>

        <div style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%); color:#666; font-size:12px;">
            DRAG VERTICAL BARS TO CHANGE LIMITS A & B
        </div>
    </div>

    <script>
        /**
         * RIEMANN SUM INTEGRATOR
         * Visualizes Definite Integral as limit of sum of rectangles.
         */

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // --- CONSTANTS ---
        let W, H;
        const GRID_SIZE = 50; // pixels per unit
        const OX = 100; // Origin X (pixels)
        const OY = 600; // Origin Y (pixels)

        // --- STATE ---
        let FUNC_TYPE = 'poly';
        let A = 1.0;
        let B = 6.0;
        let N = 10;
        let IS_3D = false;
        let ROT_ANGLE = 0;

        // Interaction
        let dragTarget = null; // 'a' or 'b'

        // --- INITIALIZATION ---
        function init() {
            resize();
            window.addEventListener('resize', resize);

            // Interaction
            canvas.addEventListener('mousedown', onDown);
            window.addEventListener('mouseup', () => dragTarget = null);
            window.addEventListener('mousemove', onMove);

            // UI Controls
            document.getElementById('sl-n').addEventListener('input', e => N = parseInt(e.target.value));
            document.getElementById('sel-func').addEventListener('change', e => FUNC_TYPE = e.target.value);

            loop();
        }

        function resize() {
            W = canvas.width = window.innerWidth;
            H = canvas.height = window.innerHeight;
            // Recenter origin
            OY = H - 100;
            OX = 100;
        }

        function toggle3D() {
            IS_3D = !IS_3D;
            document.getElementById('btn-3d').classList.toggle('active');
        }

        // --- MATH FUNCS ---
        function f(x) {
            if (FUNC_TYPE === 'poly') return -0.15 * Math.pow(x - 5, 2) + 6;
            if (FUNC_TYPE === 'sin') return 2 * Math.sin(x / 1.5) + 3;
            if (FUNC_TYPE === 'exp') return Math.exp(x / 4);
            return 0;
        }

        function exactIntegral() {
            // Calculated analytically for error checking
            // Poly: -0.15(x-5)^2 + 6 = -0.15(x^2 - 10x + 25) + 6 = -0.15x^2 + 1.5x - 3.75 + 6 = -0.15x^2 + 1.5x + 2.25
            // Int: -0.05x^3 + 0.75x^2 + 2.25x
            const F_poly = (x) => -0.05 * Math.pow(x, 3) + 0.75 * Math.pow(x, 2) + 2.25 * x;

            // Sin: 2sin(x/1.5)+3. Int: -3cos(x/1.5) + 3x
            const F_sin = (x) => -3 * Math.cos(x / 1.5) + 3 * x;

            // Exp: e^(x/4). Int: 4e^(x/4)
            const F_exp = (x) => 4 * Math.exp(x / 4);

            let F;
            if (FUNC_TYPE === 'poly') F = F_poly;
            else if (FUNC_TYPE === 'sin') F = F_sin;
            else F = F_exp;

            return F(B) - F(A);
        }

        // --- INTERACTION ---
        function onDown(e) {
            const m = mouseToGraph(e.clientX, e.clientY);
            // Check dist to A and B lines
            if (Math.abs(m.x - A) < 0.2) dragTarget = 'a';
            else if (Math.abs(m.x - B) < 0.2) dragTarget = 'b';
        }

        function onMove(e) {
            const m = mouseToGraph(e.clientX, e.clientY);

            // Cursor
            if (Math.abs(m.x - A) < 0.2 || Math.abs(m.x - B) < 0.2) canvas.style.cursor = 'col-resize';
            else canvas.style.cursor = 'default';

            if (dragTarget === 'a') {
                A = Math.max(0, Math.min(m.x, B - 0.1));
            } else if (dragTarget === 'b') {
                B = Math.max(A + 0.1, Math.min(m.x, 20)); // Limit visual range
            }
        }

        function mouseToGraph(mx, my) {
            return {
                x: (mx - OX) / GRID_SIZE,
                y: (OY - my) / GRID_SIZE
            };
        }

        // --- RENDER ---
        function loop() {
            ctx.clearRect(0, 0, W, H);

            // 1. DRAW GRID
            drawGrid();

            // 2. DRAW FUNCTION
            drawFunc();

            // 3. DRAW RIEMANN SUM
            const approx = drawRiemann();

            // 4. DRAW LIMIT CONTROLS
            drawControls();

            // 5. UPDATE UI
            const exact = exactIntegral();
            const err = Math.abs((approx - exact) / exact) * 100;

            document.getElementById('val-a').innerText = A.toFixed(2);
            document.getElementById('val-b').innerText = B.toFixed(2);
            document.getElementById('val-n').innerText = N;
            document.getElementById('val-dx').innerText = ((B - A) / N).toFixed(3);

            document.getElementById('res-approx').innerText = approx.toFixed(4);
            document.getElementById('res-exact').innerText = exact.toFixed(4);
            document.getElementById('res-err').innerText = err.toFixed(2) + "%";

            if (IS_3D) {
                ROT_ANGLE += 0.01;
                draw3DRevolution();
            }

            requestAnimationFrame(loop);
        }

        function drawGrid() {
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 1;
            ctx.beginPath();

            // Verticals
            for (let gx = OX; gx < W; gx += GRID_SIZE) { ctx.moveTo(gx, 0); ctx.lineTo(gx, H); }
            // Horizontals
            for (let gy = OY; gy > 0; gy -= GRID_SIZE) { ctx.moveTo(0, gy); ctx.lineTo(W, gy); }
            ctx.stroke();

            // Axes
            ctx.strokeStyle = '#555'; ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, OY); ctx.lineTo(W, OY); // X
            ctx.moveTo(OX, 0); ctx.lineTo(OX, H); // Y
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#666'; ctx.font = "12px monospace";
            for (let i = 0; i < 20; i++) {
                ctx.fillText(i, OX + i * GRID_SIZE - 5, OY + 20);
            }
        }

        function drawFunc() {
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 3;
            ctx.beginPath();

            let start = true;
            for (let px = 0; px < W; px += 2) {
                const x = (px - OX) / GRID_SIZE;
                const y = f(x);
                const py = OY - y * GRID_SIZE;
                if (start) { ctx.moveTo(px, py); start = false; }
                else ctx.lineTo(px, py);
            }
            ctx.stroke();
        }

        function drawRiemann() {
            const dx = (B - A) / N;
            let totalArea = 0;

            ctx.strokeStyle = 'rgba(239, 68, 68, 0.5)';
            const alpha = Math.min(0.8, 10 / N + 0.1); // Fade opacity as N increases
            ctx.fillStyle = `rgba(239, 68, 68, ${alpha})`;

            for (let i = 0; i < N; i++) {
                // Left Riemann Sum
                const xi = A + i * dx;
                const h = f(xi);
                const area = h * dx;
                totalArea += area;

                // Draw Rect
                const rx = OX + xi * GRID_SIZE;
                const ry = OY - h * GRID_SIZE;
                const rw = dx * GRID_SIZE;
                const rh = h * GRID_SIZE;

                ctx.fillRect(rx, ry, rw, rh);
                ctx.strokeRect(rx, ry, rw, rh);
            }
            return totalArea;
        }

        function drawControls() {
            // Line A
            const ax = OX + A * GRID_SIZE;
            ctx.strokeStyle = '#fff';
            ctx.setLineDash([5, 5]);
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(ax, 0); ctx.lineTo(ax, H); ctx.stroke();
            // Handle A
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(ax, OY + 30, 8, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = '#000'; ctx.textAlign = 'center'; ctx.fillText("a", ax, OY + 34);

            // Line B
            const bx = OX + B * GRID_SIZE;
            ctx.strokeStyle = '#fff';
            ctx.beginPath(); ctx.moveTo(bx, 0); ctx.lineTo(bx, H); ctx.stroke();
            // Handle B
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(bx, OY + 30, 8, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = '#000'; ctx.fillText("b", bx, OY + 34);

            ctx.setLineDash([]);
        }

        function draw3DRevolution() {
            // Draw a wireframe solid of revolution on top right overlay?
            // Or overlay on main graph?
            // Let's create a mini viewport on top right

            const w3 = 300;
            const h3 = 200;
            const x3 = W - w3 - 20;
            const y3 = 20;

            // BG
            ctx.fillStyle = '#000';
            ctx.fillRect(x3, y3, w3, h3);
            ctx.strokeStyle = '#333';
            ctx.strokeRect(x3, y3, w3, h3);

            // Center of 3D view
            const cx = x3 + w3 / 2;
            const cy = y3 + h3 / 2;

            // Draw Discs
            // We revolve around X axis.
            // X matches original function x.
            // Radius is f(x).

            // Scale down to fit
            const s3 = 10;

            // Draw Axes
            ctx.strokeStyle = '#444'; ctx.beginPath();
            ctx.moveTo(x3, cy); ctx.lineTo(x3 + w3, cy); // Axis
            ctx.stroke();

            const dx = (B - A) / 20; // Lower res for wireframe

            ctx.strokeStyle = 'rgba(239, 68, 68, 0.5)';
            ctx.lineWidth = 1;

            for (let x = A; x <= B; x += dx) {
                const r = f(x) * s3;
                const px = cx + (x - (A + B) / 2) * 20; // spread x

                // Draw ellipses
                ctx.beginPath();
                ctx.ellipse(px, cy, 3, r, 0, 0, Math.PI * 2); // Flat disc?
                // Perspective: ellipse width const, height = r
                // x is horizontal. Rotation around x.
                // So ellipses visualizes the cross section y-z.

                // Animate rotation?
                // Actually 3D wireframe is circles perp to X.
                ctx.ellipse(px, cy, 5, r, ROT_ANGLE, 0, Math.PI * 2);
                ctx.stroke();
            }

            ctx.fillStyle = '#fff'; ctx.fillText("SOLID OF REVOLUTION", x3 + 10, y3 + 20);
        }

        init();
    </script>
</body>

</html>