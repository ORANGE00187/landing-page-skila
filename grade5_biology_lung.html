<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Skila.ai | Lung Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: sans-serif;
        }

        #canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .label {
            color: white;
            position: absolute;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
    <div class="label" style="top: 20px; left: 20px;">Drag Handle to Breathe</div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let HANDLE_Y = 0; // Offset
        let PRESSURE = 1; // 1 atm
        let VOLUME = 1;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Input
        let DRAG = false;
        canvas.addEventListener('mousedown', e => {
            if (e.clientY > height * 0.7) DRAG = true;
        });
        window.addEventListener('mouseup', () => DRAG = false);
        canvas.addEventListener('mousemove', e => {
            if (DRAG) {
                // Drag diaphragm handle
                let dy = e.clientY - height * 0.7;
                HANDLE_Y = Math.max(0, Math.min(150, dy));
            } else {
                // Spring back (Exhale)
                HANDLE_Y *= 0.9;
            }
        });

        function loop() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);

            const cx = width / 2; const cy = height / 2 - 100;

            // Chest Cavity (Bottle)
            ctx.strokeStyle = 'rgba(255,255,255,0.5)'; ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(cx - 100, cy - 150); // Neck
            ctx.lineTo(cx - 150, cy);
            ctx.lineTo(cx - 150, cy + 200); // Bottom
            ctx.lineTo(cx + 150, cy + 200);
            ctx.lineTo(cx + 150, cy);
            ctx.lineTo(cx + 100, cy - 150);
            ctx.stroke();

            // Diaphragm (Rubber Sheet)
            // Curve depends on HANDLE_Y
            ctx.fillStyle = '#f87171';
            ctx.beginPath();
            ctx.moveTo(cx - 150, cy + 200);
            // Quadratic Curve to Handle
            ctx.quadraticCurveTo(cx, cy + 200 + HANDLE_Y + 50, cx + 150, cy + 200);
            ctx.fill();

            // Draw Handle
            ctx.fillStyle = '#aaa';
            ctx.fillRect(cx - 20, cy + 200 + HANDLE_Y / 2 + 25, 40, 10);
            ctx.beginPath(); ctx.moveTo(cx, cy + 200 + HANDLE_Y / 2 + 35); ctx.lineTo(cx, cy + 350); ctx.stroke();

            // Lungs (Balloons)
            // Expansion Ratio
            // Volume increases with handle down.
            const expansion = HANDLE_Y / 150; // 0 to 1
            const r = 40 + expansion * 30;

            ctx.fillStyle = '#f472b6'; // Pink

            // Left Lung
            ctx.beginPath();
            ctx.ellipse(cx - 60 - expansion * 10, cy + 50, r, r * 1.5, 0.2, 0, Math.PI * 2);
            ctx.fill();

            // Right Lung
            ctx.beginPath();
            ctx.ellipse(cx + 60 + expansion * 10, cy + 50, r, r * 1.5, -0.2, 0, Math.PI * 2);
            ctx.fill();

            // Trachea
            ctx.fillStyle = '#fbcfe8';
            ctx.fillRect(cx - 15, cy - 150, 30, 150);

            // Air Particles
            if (expansion > 0.1) {
                ctx.fillStyle = '#3b82f6';
                for (let i = 0; i < 10; i++) {
                    const x = cx + (Math.random() - 0.5) * 30;
                    const y = cy - 150 + Math.random() * 200;
                    ctx.beginPath(); ctx.arc(x, y, 3, 0, Math.PI * 2); ctx.fill();
                }
            }

            requestAnimationFrame(loop);
        }
        loop();

    </script>
</body>

</html>