<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Skila.ai | Demographic Time-Lapse</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #e2e8f0;
            font-family: 'Roboto Condensed', sans-serif;
        }

        .ui-container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 350px;
            background: white;
            padding: 30px;
            border-right: 1px solid #cbd5e1;
            display: flex;
            flex-direction: column;
            gap: 30px;
            z-index: 10;
        }

        .canvas-area {
            flex-grow: 1;
            position: relative;
            background: #f1f5f9;
        }

        h1 {
            font-size: 28px;
            color: #334155;
        }

        .metric-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .metric-title {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        input[type=range] {
            width: 100%;
        }

        .year-display {
            position: absolute;
            top: 20px;
            right: 40px;
            font-size: 100px;
            color: #cbd5e1;
            opacity: 0.5;
            font-weight: bold;
            pointer-events: none;
        }

        .btn-boom {
            background: #ec4899;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: transform 0.1s;
        }

        .btn-boom:active {
            transform: scale(0.98);
        }

        .legend {
            display: flex;
            gap: 20px;
            position: absolute;
            bottom: 20px;
            right: 40px;
        }

        .lg-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #64748b;
            font-size: 14px;
        }

        .dot {
            width: 12px;
            height: 12px;
        }
    </style>
</head>

<body>
    <div class="ui-container">
        <div class="sidebar">
            <h1>POPULATION ENGINE</h1>

            <div class="metric-card">
                <div class="metric-title">BIRTH RATE (Newborns)</div>
                <input type="range" id="rate-birth" min="0.5" max="3.0" step="0.1" value="1.0">
            </div>

            <div class="metric-card">
                <div class="metric-title">HEALTHCARE (Life Expectancy)</div>
                <input type="range" id="rate-health" min="0.8" max="1.0" step="0.01" value="0.95">
                <div style="font-size:10px; color:#94a3b8; margin-top:5px;">Reduces death rate in middle ages</div>
            </div>

            <button class="btn-boom" onclick="triggerBoom()">TRIGGER BABY BOOM</button>

            <div class="metric-card" style="margin-top:auto;">
                <div class="metric-title">TOTAL POPULATION</div>
                <div style="font-size:32px; color:#334155;" id="pop-total">0</div>
            </div>

            <div class="metric-card">
                <div class="metric-title">DEPENDENCY RATIO</div>
                <div style="font-size:20px; color:#475569;" id="dep-ratio">0%</div>
            </div>
        </div>

        <div class="canvas-area">
            <canvas id="canvas"></canvas>
            <div class="year-display" id="year-disp">1950</div>

            <div class="legend">
                <div class="lg-item">
                    <div class="dot" style="background:#3b82f6"></div> Male
                </div>
                <div class="lg-item">
                    <div class="dot" style="background:#ec4899"></div> Female
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * POPULATION PYRAMID SIM
         * Simulates cohorts aging year by year.
         * Visualizes individual "Pixel People" for texture.
         */

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const uiYear = document.getElementById('year-disp');
        const uiPop = document.getElementById('pop-total');
        const uiDep = document.getElementById('dep-ratio');

        let W, H;

        // Sim State
        let YEAR = 1950;
        let TICK = 0;

        // Cohorts: Array of 100 ages (0-99).
        // Each index contains count.
        // Actually, let's store M and F separate.
        let POP_M = new Array(100).fill(0);
        let POP_F = new Array(100).fill(0);

        let BOOM_ACTIVE = 0;

        function init() {
            // Seed initial Triangle structure (Developing Nation)
            for (let age = 0; age < 100; age++) {
                // Decay formula
                const base = 1000;
                const count = base * Math.pow(0.95, age);
                POP_M[age] = count;
                POP_F[age] = count;
            }
            resize();
            loop();
        }

        function resize() {
            W = canvas.width = document.querySelector('.canvas-area').offsetWidth;
            H = canvas.height = document.querySelector('.canvas-area').offsetHeight;
        }
        window.addEventListener('resize', resize);

        window.triggerBoom = () => { BOOM_ACTIVE = 20; }; // Lasts 20 ticks (years)

        function update() {
            TICK++;
            if (TICK % 5 === 0) { // Every 5 frames = 1 Year
                YEAR++;
                uiYear.innerText = YEAR;
                agePopulation();
            }
        }

        function agePopulation() {
            // 1. Move everyone up one age slot
            // Process from top down to avoid overwriting
            for (let age = 99; age > 0; age--) {
                // Apply Death Chance based on Age and Healthcare
                const health = parseFloat(document.getElementById('rate-health').value);
                // Death probability increases with age.
                // Base death curve:
                // Age 0-10: Low.
                // Age 10-50: Very Low.
                // Age 50-80: Rising.
                // Age 80+: High.

                let deathProb = 0.001; // Accident base
                if (age > 50) deathProb += (age - 50) * 0.002;
                if (age > 80) deathProb += (age - 80) * 0.01;

                // Healthcare mitigation
                deathProb *= (2.0 - health); // If health 1.0, prob normal. If health 0.8, prob higher?
                // Wait, higher health slider = Better.
                // So prob should decrease.
                // Prob * (1 - (health-0.5))?

                // Simpler: Survivors = Count * SurvivalRate.
                POP_M[age] = POP_M[age - 1] * (1 - deathProb);
                POP_F[age] = POP_F[age - 1] * (1 - deathProb);
            }

            // 2. Births (Age 0)
            const birthRateMod = parseFloat(document.getElementById('rate-birth').value);
            // Births depend on Reproductive Population (Females 20-40)
            let fertilePop = 0;
            for (let a = 20; a < 45; a++) fertilePop += POP_F[a];

            let newborns = fertilePop * 0.05 * birthRateMod;

            if (BOOM_ACTIVE > 0) {
                newborns *= 1.5;
                BOOM_ACTIVE--;
            }

            POP_M[0] = newborns * 0.51; // slightly more boys naturally
            POP_F[0] = newborns * 0.49;

            updateMetrics();
        }

        function updateMetrics() {
            let total = 0;
            let dep = 0; // 0-14 and 65+
            let work = 0; // 15-64

            for (let a = 0; a < 100; a++) {
                const c = POP_M[a] + POP_F[a];
                total += c;
                if (a < 15 || a >= 65) dep += c;
                else work += c;
            }

            uiPop.innerText = Math.floor(total).toLocaleString();
            const ratio = work > 0 ? (dep / work) * 100 : 0;
            uiDep.innerText = ratio.toFixed(1) + "%";
        }

        function loop() {
            update();
            render();
            requestAnimationFrame(loop);
        }

        function render() {
            ctx.clearRect(0, 0, W, H);

            const cx = W / 2;
            const floorY = H - 50;
            const scaleY = (H - 100) / 100; // Age 100 fits vertical
            const scaleX = 0.2; // Width scale

            ctx.lineWidth = scaleY - 1;

            // Draw Bars
            for (let age = 0; age < 100; age++) {
                const y = floorY - age * scaleY;

                // Male (Left)
                const wM = POP_M[age] * scaleX;
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(cx - wM, y - scaleY + 1, wM, scaleY - 1);

                // Female (Right)
                const wF = POP_F[age] * scaleX;
                ctx.fillStyle = '#ec4899';
                ctx.fillRect(cx, y - scaleY + 1, wF, scaleY - 1);
            }

            // Draw Center Line
            ctx.strokeStyle = '#fff';
            ctx.beginPath(); ctx.moveTo(cx, floorY); ctx.lineTo(cx, 50); ctx.stroke();

            // Draw Age Markers
            ctx.fillStyle = '#94a3b8'; ctx.textAlign = 'right'; font = '10px sans-serif';
            for (let a = 10; a < 100; a += 10) {
                ctx.fillText(a + "y", cx - 10, floorY - a * scaleY + 4);
            }
        }

        init();
    </script>
</body>

</html>